

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="峰影的博客是一个个人博客，专注于电子技术、STM32、PCB设计和开源社区、GITHUB。喜欢开源项目。">
  <meta name="author" content="zsf90">
  <meta name="keywords" content="峰影博客,峰影的博客,电子技术,STM32,PCB设计,开源社区,Github">
  <title>STM32 USART 函数列表和一些类型定义 - 峰影的博客</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10.4.0/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css" />
  



<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"fy2008.github.io","root":"/","version":"1.8.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":true},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"onlypost":false},"web_analytics":{"enable":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":"21vmNUBs7rFRciAemNv5usxG-gzGzoHsz","app_key":"kMbwFAh9m1RUo216tJgCkNR0","server_url":"https://21vmnubs.lc-cn-n1-shared.com"}}};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.3.0"><link rel="alternate" href="/atom.xml" title="峰影的博客" type="application/atom+xml">
</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>峰影的博客</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/links/">
                <i class="iconfont icon-link-fill"></i>
                友链
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/5.jpg') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="STM32 USART 函数列表和一些类型定义">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-01-05 18:05" pubdate>
        2021年1月5日 晚上
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      6.6k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      128
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">STM32 USART 函数列表和一些类型定义</h1>
            
              <p class="note note-info">
                
                  本文最后更新于：2021年1月6日 下午
                
              </p>
            
            <div class="markdown-body">
              <p>本篇文章是一篇介绍 STM32 USART 相关函数的笔记，下次忘记的时候可以方便查找。</p>
<h2 id="串口寄存器列表"><a href="#串口寄存器列表" class="headerlink" title="串口寄存器列表"></a>串口寄存器列表</h2><ol>
<li>状态寄存器 (USART_SR)</li>
<li>数据寄存器 (USART_DR)</li>
<li>波特率寄存器 (USART_BRR)</li>
<li>智能卡模式下的保护时间寄存器 (USART_GTPR)</li>
<li></li>
</ol>
<p>与STM32 USART 相关的函数和一些类型。</p>
<h2 id="函数列表"><a href="#函数列表" class="headerlink" title="函数列表"></a>函数列表</h2><ul>
<li>HAL_UART_Abort()</li>
<li>HAL_UART_Abort_IT()</li>
<li>HAL_UART_AbortCpltCallback()</li>
<li>HAL_UART_AbortReceive()</li>
<li>HAL_UART_AbortReceive_IT()</li>
<li>HAL_UART_AbortReceiveCpltCallback()</li>
<li>HAL_UART_AbortTransmit()</li>
<li>HAL_UART_AbortTransmit_IT()</li>
<li>HAL_UART_AbortTransmitCpltCallback()</li>
<li>HAL_UART_DeInit()</li>
<li>HAL_UART_DMAPause()</li>
<li>HAL_UART_DMAResume()</li>
<li>HAL_UART_DMAStop()</li>
<li>HAL_UART_ErrorCallback()</li>
<li>HAL_UART_GetError()</li>
<li>HAL_UART_GetState()</li>
<li>HAL_UART_Init()</li>
<li>HAL_UART_IRQHandler()</li>
<li>HAL_UART_MspDeInit()</li>
<li>HAL_UART_Receive()</li>
<li>HAL_UART_Receive_DMA()</li>
<li>HAL_UART_Receive_IT()</li>
<li>HAL_UART_RxCpltCallback()</li>
<li>HAL_UART_Transmit()</li>
<li>HAL_UART_Transmit_DMA()</li>
<li>HAL_UART_Transmit_IT()</li>
<li>HAL_UART_TxCpltCallback()</li>
<li>HAL_UART_TxHalfCpltCallback()</li>
<li>HAL_HalfDuplex_EnableTransmitter()</li>
</ul>
<h3 id="中止正在进行的传输-阻塞模式-HAL-UART-Abort"><a href="#中止正在进行的传输-阻塞模式-HAL-UART-Abort" class="headerlink" title="中止正在进行的传输(阻塞模式) - HAL_UART_Abort()"></a>中止正在进行的传输(阻塞模式) - HAL_UART_Abort()</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Abort</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Disable TXEIE, TCIE, RXNE, PE and ERR (Frame error, noise error, overrun error) interrupts */</span><br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR1, (USART_CR1_RXNEIE | USART_CR1_PEIE | USART_CR1_TXEIE | USART_CR1_TCIE));<br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_EIE);<br><br>  <span class="hljs-comment">/* Disable the UART DMA Tx request if enabled */</span><br>  <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT))<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Tx stream: use blocking DMA Abort API (no callback) */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmatx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Set the UART DMA Abort callback to Null.</span><br><span class="hljs-comment">         No call back execution at end of DMA abort procedure */</span><br>      huart-&gt;hdmatx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br><br>      <span class="hljs-keyword">if</span> (HAL_DMA_Abort(huart-&gt;hdmatx) != HAL_OK)<br>      &#123;<br>        <span class="hljs-keyword">if</span> (HAL_DMA_GetError(huart-&gt;hdmatx) == HAL_DMA_ERROR_TIMEOUT)<br>        &#123;<br>          <span class="hljs-comment">/* Set error code to DMA */</span><br>          huart-&gt;ErrorCode = HAL_UART_ERROR_DMA;<br><br>          <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">/* Disable the UART DMA Rx request if enabled */</span><br>  <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR))<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Rx stream: use blocking DMA Abort API (no callback) */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmarx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Set the UART DMA Abort callback to Null.</span><br><span class="hljs-comment">         No call back execution at end of DMA abort procedure */</span><br>      huart-&gt;hdmarx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br><br>      <span class="hljs-keyword">if</span> (HAL_DMA_Abort(huart-&gt;hdmarx) != HAL_OK)<br>      &#123;<br>        <span class="hljs-keyword">if</span> (HAL_DMA_GetError(huart-&gt;hdmarx) == HAL_DMA_ERROR_TIMEOUT)<br>        &#123;<br>          <span class="hljs-comment">/* Set error code to DMA */</span><br>          huart-&gt;ErrorCode = HAL_UART_ERROR_DMA;<br><br>          <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">/* Reset Tx and Rx transfer counters */</span><br>  huart-&gt;TxXferCount = <span class="hljs-number">0x00</span>U;<br>  huart-&gt;RxXferCount = <span class="hljs-number">0x00</span>U;<br><br>  <span class="hljs-comment">/* Reset ErrorCode */</span><br>  huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br><br>  <span class="hljs-comment">/* Restore huart-&gt;RxState and huart-&gt;gState to Ready */</span><br>  huart-&gt;RxState = HAL_UART_STATE_READY;<br>  huart-&gt;gState = HAL_UART_STATE_READY;<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>
<h3 id="中止正在进行的传输-中断模式-HAL-UART-Abort-IT-UART-HandleTypeDef-huart"><a href="#中止正在进行的传输-中断模式-HAL-UART-Abort-IT-UART-HandleTypeDef-huart" class="headerlink" title="中止正在进行的传输(中断模式) - HAL_UART_Abort_IT(UART_HandleTypeDef *huart)"></a>中止正在进行的传输(中断模式) - HAL_UART_Abort_IT(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Abort_IT</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint32_t</span> AbortCplt = <span class="hljs-number">0x01</span>U;<br><br>  <span class="hljs-comment">/* Disable TXEIE, TCIE, RXNE, PE and ERR (Frame error, noise error, overrun error) interrupts */</span><br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR1, (USART_CR1_RXNEIE | USART_CR1_PEIE | USART_CR1_TXEIE | USART_CR1_TCIE));<br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_EIE);<br><br>  <span class="hljs-comment">/* If DMA Tx and/or DMA Rx Handles are associated to UART Handle, DMA Abort complete callbacks should be initialised</span><br><span class="hljs-comment">     before any call to DMA Abort functions */</span><br>  <span class="hljs-comment">/* DMA Tx Handle is valid */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;hdmatx != <span class="hljs-literal">NULL</span>)<br>  &#123;<br>    <span class="hljs-comment">/* Set DMA Abort Complete callback if UART DMA Tx request if enabled.</span><br><span class="hljs-comment">       Otherwise, set it to NULL */</span><br>    <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT))<br>    &#123;<br>      huart-&gt;hdmatx-&gt;XferAbortCallback = UART_DMATxAbortCallback;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      huart-&gt;hdmatx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br>    &#125;<br>  &#125;<br>  <span class="hljs-comment">/* DMA Rx Handle is valid */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;hdmarx != <span class="hljs-literal">NULL</span>)<br>  &#123;<br>    <span class="hljs-comment">/* Set DMA Abort Complete callback if UART DMA Rx request if enabled.</span><br><span class="hljs-comment">       Otherwise, set it to NULL */</span><br>    <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR))<br>    &#123;<br>      huart-&gt;hdmarx-&gt;XferAbortCallback = UART_DMARxAbortCallback;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      huart-&gt;hdmarx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">/* Disable the UART DMA Tx request if enabled */</span><br>  <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT))<br>  &#123;<br>    <span class="hljs-comment">/* Disable DMA Tx at UART level */</span><br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Tx stream : use non blocking DMA Abort API (callback) */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmatx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* UART Tx DMA Abort callback has already been initialised :</span><br><span class="hljs-comment">         will lead to call HAL_UART_AbortCpltCallback() at end of DMA abort procedure */</span><br><br>      <span class="hljs-comment">/* Abort DMA TX */</span><br>      <span class="hljs-keyword">if</span> (HAL_DMA_Abort_IT(huart-&gt;hdmatx) != HAL_OK)<br>      &#123;<br>        huart-&gt;hdmatx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        AbortCplt = <span class="hljs-number">0x00</span>U;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">/* Disable the UART DMA Rx request if enabled */</span><br>  <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR))<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Rx stream : use non blocking DMA Abort API (callback) */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmarx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* UART Rx DMA Abort callback has already been initialised :</span><br><span class="hljs-comment">         will lead to call HAL_UART_AbortCpltCallback() at end of DMA abort procedure */</span><br><br>      <span class="hljs-comment">/* Abort DMA RX */</span><br>      <span class="hljs-keyword">if</span> (HAL_DMA_Abort_IT(huart-&gt;hdmarx) != HAL_OK)<br>      &#123;<br>        huart-&gt;hdmarx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br>        AbortCplt = <span class="hljs-number">0x01</span>U;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        AbortCplt = <span class="hljs-number">0x00</span>U;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">/* if no DMA abort complete callback execution is required =&gt; call user Abort Complete callback */</span><br>  <span class="hljs-keyword">if</span> (AbortCplt == <span class="hljs-number">0x01</span>U)<br>  &#123;<br>    <span class="hljs-comment">/* Reset Tx and Rx transfer counters */</span><br>    huart-&gt;TxXferCount = <span class="hljs-number">0x00</span>U;<br>    huart-&gt;RxXferCount = <span class="hljs-number">0x00</span>U;<br><br>    <span class="hljs-comment">/* Reset ErrorCode */</span><br>    huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br><br>    <span class="hljs-comment">/* Restore huart-&gt;gState and huart-&gt;RxState to Ready */</span><br>    huart-&gt;gState  = HAL_UART_STATE_READY;<br>    huart-&gt;RxState = HAL_UART_STATE_READY;<br><br>    <span class="hljs-comment">/* As no DMA to be aborted, call directly user Abort complete callback */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>    <span class="hljs-comment">/* Call registered Abort complete callback */</span><br>    huart-&gt;AbortCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-comment">/* Call legacy weak Abort complete callback */</span><br>    HAL_UART_AbortCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br>  &#125;<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br><br></code></pre></div></td></tr></table></figure>
<h3 id="UART中止完全回调-void-HAL-UART-AbortCpltCallback"><a href="#UART中止完全回调-void-HAL-UART-AbortCpltCallback" class="headerlink" title="UART中止完全回调 - void HAL_UART_AbortCpltCallback"></a>UART中止完全回调 - void HAL_UART_AbortCpltCallback</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_AbortCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br></code></pre></div></td></tr></table></figure>
<p>这是 <code>UART</code> 中止完成后调用的回调函数，需要自己根据需求进行实现。</p>
<h3 id="中止正在进行的接收传输-阻塞模式-HAL-UART-AbortReceive"><a href="#中止正在进行的接收传输-阻塞模式-HAL-UART-AbortReceive" class="headerlink" title="中止正在进行的接收传输(阻塞模式) - HAL_UART_AbortReceive"></a>中止正在进行的接收传输(阻塞模式) - HAL_UART_AbortReceive</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_AbortReceive</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Disable RXNE, PE and ERR (Frame error, noise error, overrun error) interrupts */</span><br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR1, (USART_CR1_RXNEIE | USART_CR1_PEIE));<br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_EIE);<br><br>  <span class="hljs-comment">/* Disable the UART DMA Rx request if enabled */</span><br>  <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR))<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Rx stream : use blocking DMA Abort API (no callback) */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmarx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Set the UART DMA Abort callback to Null.</span><br><span class="hljs-comment">         No call back execution at end of DMA abort procedure */</span><br>      huart-&gt;hdmarx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br><br>      <span class="hljs-keyword">if</span> (HAL_DMA_Abort(huart-&gt;hdmarx) != HAL_OK)<br>      &#123;<br>        <span class="hljs-keyword">if</span> (HAL_DMA_GetError(huart-&gt;hdmarx) == HAL_DMA_ERROR_TIMEOUT)<br>        &#123;<br>          <span class="hljs-comment">/* Set error code to DMA */</span><br>          huart-&gt;ErrorCode = HAL_UART_ERROR_DMA;<br><br>          <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">/* Reset Rx transfer counter */</span><br>  huart-&gt;RxXferCount = <span class="hljs-number">0x00</span>U;<br><br>  <span class="hljs-comment">/* Restore huart-&gt;RxState to Ready */</span><br>  huart-&gt;RxState = HAL_UART_STATE_READY;<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="中止正在进行的接收传输-中断模式-HAL-UART-AbortReceive-IT"><a href="#中止正在进行的接收传输-中断模式-HAL-UART-AbortReceive-IT" class="headerlink" title="中止正在进行的接收传输(中断模式) - HAL_UART_AbortReceive_IT"></a>中止正在进行的接收传输(中断模式) - HAL_UART_AbortReceive_IT</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_AbortReceive_IT</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Disable RXNE, PE and ERR (Frame error, noise error, overrun error) interrupts */</span><br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR1, (USART_CR1_RXNEIE | USART_CR1_PEIE));<br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_EIE);<br><br>  <span class="hljs-comment">/* Disable the UART DMA Rx request if enabled */</span><br>  <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR))<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Rx stream : use blocking DMA Abort API (no callback) */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmarx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Set the UART DMA Abort callback :</span><br><span class="hljs-comment">         will lead to call HAL_UART_AbortCpltCallback() at end of DMA abort procedure */</span><br>      huart-&gt;hdmarx-&gt;XferAbortCallback = UART_DMARxOnlyAbortCallback;<br><br>      <span class="hljs-comment">/* Abort DMA RX */</span><br>      <span class="hljs-keyword">if</span> (HAL_DMA_Abort_IT(huart-&gt;hdmarx) != HAL_OK)<br>      &#123;<br>        <span class="hljs-comment">/* Call Directly huart-&gt;hdmarx-&gt;XferAbortCallback function in case of error */</span><br>        huart-&gt;hdmarx-&gt;XferAbortCallback(huart-&gt;hdmarx);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-comment">/* Reset Rx transfer counter */</span><br>      huart-&gt;RxXferCount = <span class="hljs-number">0x00</span>U;<br><br>      <span class="hljs-comment">/* Restore huart-&gt;RxState to Ready */</span><br>      huart-&gt;RxState = HAL_UART_STATE_READY;<br><br>      <span class="hljs-comment">/* As no DMA to be aborted, call directly user Abort complete callback */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>      <span class="hljs-comment">/* Call registered Abort Receive Complete Callback */</span><br>      huart-&gt;AbortReceiveCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>      <span class="hljs-comment">/* Call legacy weak Abort Receive Complete Callback */</span><br>      HAL_UART_AbortReceiveCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-comment">/* Reset Rx transfer counter */</span><br>    huart-&gt;RxXferCount = <span class="hljs-number">0x00</span>U;<br><br>    <span class="hljs-comment">/* Restore huart-&gt;RxState to Ready */</span><br>    huart-&gt;RxState = HAL_UART_STATE_READY;<br><br>    <span class="hljs-comment">/* As no DMA to be aborted, call directly user Abort complete callback */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>    <span class="hljs-comment">/* Call registered Abort Receive Complete Callback */</span><br>    huart-&gt;AbortReceiveCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-comment">/* Call legacy weak Abort Receive Complete Callback */</span><br>    HAL_UART_AbortReceiveCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br>  &#125;<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="UART-Abort接收完整回调-HAL-UART-AbortReceiveCpltCallback"><a href="#UART-Abort接收完整回调-HAL-UART-AbortReceiveCpltCallback" class="headerlink" title="UART Abort接收完整回调 - HAL_UART_AbortReceiveCpltCallback"></a>UART Abort接收完整回调 - HAL_UART_AbortReceiveCpltCallback</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_AbortReceiveCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Prevent unused argument(s) compilation warning */</span><br>  UNUSED(huart);<br><br>  <span class="hljs-comment">/* NOTE : This function should not be modified, when the callback is needed,</span><br><span class="hljs-comment">            the HAL_UART_AbortReceiveCpltCallback can be implemented in the user file.</span><br><span class="hljs-comment">   */</span><br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="中止正在进行的传输传输-阻塞模式-HAL-UART-AbortTransmit"><a href="#中止正在进行的传输传输-阻塞模式-HAL-UART-AbortTransmit" class="headerlink" title="中止正在进行的传输传输(阻塞模式) - HAL_UART_AbortTransmit"></a>中止正在进行的传输传输(阻塞模式) - HAL_UART_AbortTransmit</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_AbortTransmit</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Disable TXEIE and TCIE interrupts */</span><br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR1, (USART_CR1_TXEIE | USART_CR1_TCIE));<br><br>  <span class="hljs-comment">/* Disable the UART DMA Tx request if enabled */</span><br>  <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT))<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Tx stream : use blocking DMA Abort API (no callback) */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmatx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Set the UART DMA Abort callback to Null.</span><br><span class="hljs-comment">         No call back execution at end of DMA abort procedure */</span><br>      huart-&gt;hdmatx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br><br>      <span class="hljs-keyword">if</span> (HAL_DMA_Abort(huart-&gt;hdmatx) != HAL_OK)<br>      &#123;<br>        <span class="hljs-keyword">if</span> (HAL_DMA_GetError(huart-&gt;hdmatx) == HAL_DMA_ERROR_TIMEOUT)<br>        &#123;<br>          <span class="hljs-comment">/* Set error code to DMA */</span><br>          huart-&gt;ErrorCode = HAL_UART_ERROR_DMA;<br><br>          <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>        &#125;<br>      &#125;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">/* Reset Tx transfer counter */</span><br>  huart-&gt;TxXferCount = <span class="hljs-number">0x00</span>U;<br><br>  <span class="hljs-comment">/* Restore huart-&gt;gState to Ready */</span><br>  huart-&gt;gState = HAL_UART_STATE_READY;<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="中止正在进行的传输传输-中断模式-HAL-UART-AbortTransmit-IT"><a href="#中止正在进行的传输传输-中断模式-HAL-UART-AbortTransmit-IT" class="headerlink" title="中止正在进行的传输传输(中断模式) - HAL_UART_AbortTransmit_IT"></a>中止正在进行的传输传输(中断模式) - HAL_UART_AbortTransmit_IT</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_AbortTransmit_IT</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Disable TXEIE and TCIE interrupts */</span><br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR1, (USART_CR1_TXEIE | USART_CR1_TCIE));<br><br>  <span class="hljs-comment">/* Disable the UART DMA Tx request if enabled */</span><br>  <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT))<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Tx stream : use blocking DMA Abort API (no callback) */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmatx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      <span class="hljs-comment">/* Set the UART DMA Abort callback :</span><br><span class="hljs-comment">         will lead to call HAL_UART_AbortCpltCallback() at end of DMA abort procedure */</span><br>      huart-&gt;hdmatx-&gt;XferAbortCallback = UART_DMATxOnlyAbortCallback;<br><br>      <span class="hljs-comment">/* Abort DMA TX */</span><br>      <span class="hljs-keyword">if</span> (HAL_DMA_Abort_IT(huart-&gt;hdmatx) != HAL_OK)<br>      &#123;<br>        <span class="hljs-comment">/* Call Directly huart-&gt;hdmatx-&gt;XferAbortCallback function in case of error */</span><br>        huart-&gt;hdmatx-&gt;XferAbortCallback(huart-&gt;hdmatx);<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      <span class="hljs-comment">/* Reset Tx transfer counter */</span><br>      huart-&gt;TxXferCount = <span class="hljs-number">0x00</span>U;<br><br>      <span class="hljs-comment">/* Restore huart-&gt;gState to Ready */</span><br>      huart-&gt;gState = HAL_UART_STATE_READY;<br><br>      <span class="hljs-comment">/* As no DMA to be aborted, call directly user Abort complete callback */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>      <span class="hljs-comment">/* Call registered Abort Transmit Complete Callback */</span><br>      huart-&gt;AbortTransmitCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>      <span class="hljs-comment">/* Call legacy weak Abort Transmit Complete Callback */</span><br>      HAL_UART_AbortTransmitCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-comment">/* Reset Tx transfer counter */</span><br>    huart-&gt;TxXferCount = <span class="hljs-number">0x00</span>U;<br><br>    <span class="hljs-comment">/* Restore huart-&gt;gState to Ready */</span><br>    huart-&gt;gState = HAL_UART_STATE_READY;<br><br>    <span class="hljs-comment">/* As no DMA to be aborted, call directly user Abort complete callback */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>    <span class="hljs-comment">/* Call registered Abort Transmit Complete Callback */</span><br>    huart-&gt;AbortTransmitCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-comment">/* Call legacy weak Abort Transmit Complete Callback */</span><br>    HAL_UART_AbortTransmitCpltCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br>  &#125;<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="UART中止完全回调。"><a href="#UART中止完全回调。" class="headerlink" title="UART中止完全回调。"></a>UART中止完全回调。</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_AbortTransmitCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Prevent unused argument(s) compilation warning */</span><br>  UNUSED(huart);<br><br>  <span class="hljs-comment">/* NOTE : This function should not be modified, when the callback is needed,</span><br><span class="hljs-comment">            the HAL_UART_AbortTransmitCpltCallback can be implemented in the user file.</span><br><span class="hljs-comment">   */</span><br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="反初始化UART外围设备-HAL-UART-DeInit"><a href="#反初始化UART外围设备-HAL-UART-DeInit" class="headerlink" title="反初始化UART外围设备 - HAL_UART_DeInit"></a>反初始化UART外围设备 - HAL_UART_DeInit</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_DeInit</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Check the UART handle allocation */</span><br>  <span class="hljs-keyword">if</span> (huart == <span class="hljs-literal">NULL</span>)<br>  &#123;<br>    <span class="hljs-keyword">return</span> HAL_ERROR;<br>  &#125;<br><br>  <span class="hljs-comment">/* Check the parameters */</span><br>  assert_param(IS_UART_INSTANCE(huart-&gt;Instance));<br><br>  huart-&gt;gState = HAL_UART_STATE_BUSY;<br><br>  <span class="hljs-comment">/* Disable the Peripheral */</span><br>  __HAL_UART_DISABLE(huart);<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;MspDeInitCallback == <span class="hljs-literal">NULL</span>)<br>  &#123;<br>    huart-&gt;MspDeInitCallback = HAL_UART_MspDeInit;<br>  &#125;<br>  <span class="hljs-comment">/* DeInit the low level hardware */</span><br>  huart-&gt;MspDeInitCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>  <span class="hljs-comment">/* DeInit the low level hardware */</span><br>  HAL_UART_MspDeInit(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* (USE_HAL_UART_REGISTER_CALLBACKS) */</span></span><br><br>  huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>  huart-&gt;gState = HAL_UART_STATE_RESET;<br>  huart-&gt;RxState = HAL_UART_STATE_RESET;<br><br>  <span class="hljs-comment">/* Process Unlock */</span><br>  __HAL_UNLOCK(huart);<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-DMAPause"><a href="#HAL-UART-DMAPause" class="headerlink" title="HAL_UART_DMAPause"></a>HAL_UART_DMAPause</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief Pauses the DMA Transfer.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_DMAPause</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint32_t</span> dmarequest = <span class="hljs-number">0x00</span>U;<br><br>  <span class="hljs-comment">/* Process Locked */</span><br>  __HAL_LOCK(huart);<br><br>  dmarequest = HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br>  <span class="hljs-keyword">if</span> ((huart-&gt;gState == HAL_UART_STATE_BUSY_TX) &amp;&amp; dmarequest)<br>  &#123;<br>    <span class="hljs-comment">/* Disable the UART DMA Tx request */</span><br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br>  &#125;<br><br>  dmarequest = HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br>  <span class="hljs-keyword">if</span> ((huart-&gt;RxState == HAL_UART_STATE_BUSY_RX) &amp;&amp; dmarequest)<br>  &#123;<br>    <span class="hljs-comment">/* Disable RXNE, PE and ERR (Frame error, noise error, overrun error) interrupts */</span><br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR1, USART_CR1_PEIE);<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_EIE);<br><br>    <span class="hljs-comment">/* Disable the UART DMA Rx request */</span><br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br>  &#125;<br><br>  <span class="hljs-comment">/* Process Unlocked */</span><br>  __HAL_UNLOCK(huart);<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id=""><a href="#" class="headerlink" title=""></a></h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief Resumes the DMA Transfer.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_DMAResume</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Process Locked */</span><br>  __HAL_LOCK(huart);<br><br>  <span class="hljs-keyword">if</span> (huart-&gt;gState == HAL_UART_STATE_BUSY_TX)<br>  &#123;<br>    <span class="hljs-comment">/* Enable the UART DMA Tx request */</span><br>    SET_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (huart-&gt;RxState == HAL_UART_STATE_BUSY_RX)<br>  &#123;<br>    <span class="hljs-comment">/* Clear the Overrun flag before resuming the Rx transfer*/</span><br>    __HAL_UART_CLEAR_OREFLAG(huart);<br><br>    <span class="hljs-comment">/* Reenable PE and ERR (Frame error, noise error, overrun error) interrupts */</span><br>    SET_BIT(huart-&gt;Instance-&gt;CR1, USART_CR1_PEIE);<br>    SET_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_EIE);<br><br>    <span class="hljs-comment">/* Enable the UART DMA Rx request */</span><br>    SET_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br>  &#125;<br><br>  <span class="hljs-comment">/* Process Unlocked */</span><br>  __HAL_UNLOCK(huart);<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-DMAStop-UART-HandleTypeDef-huart"><a href="#HAL-UART-DMAStop-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_DMAStop(UART_HandleTypeDef *huart)"></a>HAL_UART_DMAStop(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief Stops the DMA Transfer.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_DMAStop</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint32_t</span> dmarequest = <span class="hljs-number">0x00</span>U;<br>  <span class="hljs-comment">/* The Lock is not implemented on this API to allow the user application</span><br><span class="hljs-comment">     to call the HAL UART API under callbacks HAL_UART_TxCpltCallback() / HAL_UART_RxCpltCallback():</span><br><span class="hljs-comment">     when calling HAL_DMA_Abort() API the DMA TX/RX Transfer complete interrupt is generated</span><br><span class="hljs-comment">     and the correspond call back is executed HAL_UART_TxCpltCallback() / HAL_UART_RxCpltCallback()</span><br><span class="hljs-comment">     */</span><br><br>  <span class="hljs-comment">/* Stop UART DMA Tx request if ongoing */</span><br>  dmarequest = HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br>  <span class="hljs-keyword">if</span> ((huart-&gt;gState == HAL_UART_STATE_BUSY_TX) &amp;&amp; dmarequest)<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Tx stream */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmatx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      HAL_DMA_Abort(huart-&gt;hdmatx);<br>    &#125;<br>    UART_EndTxTransfer(huart);<br>  &#125;<br><br>  <span class="hljs-comment">/* Stop UART DMA Rx request if ongoing */</span><br>  dmarequest = HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br>  <span class="hljs-keyword">if</span> ((huart-&gt;RxState == HAL_UART_STATE_BUSY_RX) &amp;&amp; dmarequest)<br>  &#123;<br>    CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br><br>    <span class="hljs-comment">/* Abort the UART DMA Rx stream */</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;hdmarx != <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      HAL_DMA_Abort(huart-&gt;hdmarx);<br>    &#125;<br>    UART_EndRxTransfer(huart);<br>  &#125;<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-ErrorCallback-UART-HandleTypeDef-huart"><a href="#HAL-UART-ErrorCallback-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_ErrorCallback(UART_HandleTypeDef *huart)"></a>HAL_UART_ErrorCallback(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  UART error callbacks.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_ErrorCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Prevent unused argument(s) compilation warning */</span><br>  UNUSED(huart);<br>  <span class="hljs-comment">/* <span class="hljs-doctag">NOTE:</span> This function should not be modified, when the callback is needed,</span><br><span class="hljs-comment">           the HAL_UART_ErrorCallback could be implemented in the user file</span><br><span class="hljs-comment">   */</span><br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-GetError-UART-HandleTypeDef-huart"><a href="#HAL-UART-GetError-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_GetError(UART_HandleTypeDef *huart)"></a>HAL_UART_GetError(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Return the UART error code</span><br><span class="hljs-comment">  * @param  huart Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *               the configuration information for the specified UART.</span><br><span class="hljs-comment">  * @retval UART Error Code</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">uint32_t</span> <span class="hljs-title">HAL_UART_GetError</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">return</span> huart-&gt;ErrorCode;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-GetState-UART-HandleTypeDef-huart"><a href="#HAL-UART-GetState-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_GetState(UART_HandleTypeDef *huart)"></a>HAL_UART_GetState(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Returns the UART state.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval HAL state</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_UART_StateTypeDef <span class="hljs-title">HAL_UART_GetState</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint32_t</span> temp1 = <span class="hljs-number">0x00</span>U, temp2 = <span class="hljs-number">0x00</span>U;<br>  temp1 = huart-&gt;gState;<br>  temp2 = huart-&gt;RxState;<br><br>  <span class="hljs-keyword">return</span> (HAL_UART_StateTypeDef)(temp1 | temp2);<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-Init-UART-HandleTypeDef-huart"><a href="#HAL-UART-Init-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_Init(UART_HandleTypeDef *huart)"></a>HAL_UART_Init(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Initializes the UART mode according to the specified parameters in</span><br><span class="hljs-comment">  *         the UART_InitTypeDef and create the associated handle.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Init</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Check the UART handle allocation */</span><br>  <span class="hljs-keyword">if</span> (huart == <span class="hljs-literal">NULL</span>)<br>  &#123;<br>    <span class="hljs-keyword">return</span> HAL_ERROR;<br>  &#125;<br><br>  <span class="hljs-comment">/* Check the parameters */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;Init.HwFlowCtl != UART_HWCONTROL_NONE)<br>  &#123;<br>    <span class="hljs-comment">/* The hardware flow control is available only for USART1, USART2, USART3 and USART6.</span><br><span class="hljs-comment">       Except for STM32F446xx devices, that is available for USART1, USART2, USART3, USART6, UART4 and UART5.</span><br><span class="hljs-comment">    */</span><br>    assert_param(IS_UART_HWFLOW_INSTANCE(huart-&gt;Instance));<br>    assert_param(IS_UART_HARDWARE_FLOW_CONTROL(huart-&gt;Init.HwFlowCtl));<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    assert_param(IS_UART_INSTANCE(huart-&gt;Instance));<br>  &#125;<br>  assert_param(IS_UART_WORD_LENGTH(huart-&gt;Init.WordLength));<br>  assert_param(IS_UART_OVERSAMPLING(huart-&gt;Init.OverSampling));<br><br>  <span class="hljs-keyword">if</span> (huart-&gt;gState == HAL_UART_STATE_RESET)<br>  &#123;<br>    <span class="hljs-comment">/* Allocate lock resource and initialize it */</span><br>    huart-&gt;Lock = HAL_UNLOCKED;<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>    UART_InitCallbacksToDefault(huart);<br><br>    <span class="hljs-keyword">if</span> (huart-&gt;MspInitCallback == <span class="hljs-literal">NULL</span>)<br>    &#123;<br>      huart-&gt;MspInitCallback = HAL_UART_MspInit;<br>    &#125;<br><br>    <span class="hljs-comment">/* Init the low level hardware */</span><br>    huart-&gt;MspInitCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>    <span class="hljs-comment">/* Init the low level hardware : GPIO, CLOCK */</span><br>    HAL_UART_MspInit(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* (USE_HAL_UART_REGISTER_CALLBACKS) */</span></span><br>  &#125;<br><br>  huart-&gt;gState = HAL_UART_STATE_BUSY;<br><br>  <span class="hljs-comment">/* Disable the peripheral */</span><br>  __HAL_UART_DISABLE(huart);<br><br>  <span class="hljs-comment">/* Set the UART Communication parameters */</span><br>  UART_SetConfig(huart);<br><br>  <span class="hljs-comment">/* In asynchronous mode, the following bits must be kept cleared:</span><br><span class="hljs-comment">     - LINEN and CLKEN bits in the USART_CR2 register,</span><br><span class="hljs-comment">     - SCEN, HDSEL and IREN  bits in the USART_CR3 register.*/</span><br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR2, (USART_CR2_LINEN | USART_CR2_CLKEN));<br>  CLEAR_BIT(huart-&gt;Instance-&gt;CR3, (USART_CR3_SCEN | USART_CR3_HDSEL | USART_CR3_IREN));<br><br>  <span class="hljs-comment">/* Enable the peripheral */</span><br>  __HAL_UART_ENABLE(huart);<br><br>  <span class="hljs-comment">/* Initialize the UART state */</span><br>  huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>  huart-&gt;gState = HAL_UART_STATE_READY;<br>  huart-&gt;RxState = HAL_UART_STATE_READY;<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-IRQHandler-UART-HandleTypeDef-huart"><a href="#HAL-UART-IRQHandler-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_IRQHandler(UART_HandleTypeDef *huart)"></a>HAL_UART_IRQHandler(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  This function handles UART interrupt request.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_IRQHandler</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint32_t</span> isrflags   = READ_REG(huart-&gt;Instance-&gt;SR);<br>  <span class="hljs-keyword">uint32_t</span> cr1its     = READ_REG(huart-&gt;Instance-&gt;CR1);<br>  <span class="hljs-keyword">uint32_t</span> cr3its     = READ_REG(huart-&gt;Instance-&gt;CR3);<br>  <span class="hljs-keyword">uint32_t</span> errorflags = <span class="hljs-number">0x00</span>U;<br>  <span class="hljs-keyword">uint32_t</span> dmarequest = <span class="hljs-number">0x00</span>U;<br><br>  <span class="hljs-comment">/* If no error occurs */</span><br>  errorflags = (isrflags &amp; (<span class="hljs-keyword">uint32_t</span>)(USART_SR_PE | USART_SR_FE | USART_SR_ORE | USART_SR_NE));<br>  <span class="hljs-keyword">if</span> (errorflags == RESET)<br>  &#123;<br>    <span class="hljs-comment">/* UART in mode Receiver -------------------------------------------------*/</span><br>    <span class="hljs-keyword">if</span> (((isrflags &amp; USART_SR_RXNE) != RESET) &amp;&amp; ((cr1its &amp; USART_CR1_RXNEIE) != RESET))<br>    &#123;<br>      UART_Receive_IT(huart);<br>      <span class="hljs-keyword">return</span>;<br>    &#125;<br>  &#125;<br><br>  <span class="hljs-comment">/* If some errors occur */</span><br>  <span class="hljs-keyword">if</span> ((errorflags != RESET) &amp;&amp; (((cr3its &amp; USART_CR3_EIE) != RESET) || ((cr1its &amp; (USART_CR1_RXNEIE | USART_CR1_PEIE)) != RESET)))<br>  &#123;<br>    <span class="hljs-comment">/* UART parity error interrupt occurred ----------------------------------*/</span><br>    <span class="hljs-keyword">if</span> (((isrflags &amp; USART_SR_PE) != RESET) &amp;&amp; ((cr1its &amp; USART_CR1_PEIE) != RESET))<br>    &#123;<br>      huart-&gt;ErrorCode |= HAL_UART_ERROR_PE;<br>    &#125;<br><br>    <span class="hljs-comment">/* UART noise error interrupt occurred -----------------------------------*/</span><br>    <span class="hljs-keyword">if</span> (((isrflags &amp; USART_SR_NE) != RESET) &amp;&amp; ((cr3its &amp; USART_CR3_EIE) != RESET))<br>    &#123;<br>      huart-&gt;ErrorCode |= HAL_UART_ERROR_NE;<br>    &#125;<br><br>    <span class="hljs-comment">/* UART frame error interrupt occurred -----------------------------------*/</span><br>    <span class="hljs-keyword">if</span> (((isrflags &amp; USART_SR_FE) != RESET) &amp;&amp; ((cr3its &amp; USART_CR3_EIE) != RESET))<br>    &#123;<br>      huart-&gt;ErrorCode |= HAL_UART_ERROR_FE;<br>    &#125;<br><br>    <span class="hljs-comment">/* UART Over-Run interrupt occurred --------------------------------------*/</span><br>    <span class="hljs-keyword">if</span> (((isrflags &amp; USART_SR_ORE) != RESET) &amp;&amp; (((cr1its &amp; USART_CR1_RXNEIE) != RESET) || ((cr3its &amp; USART_CR3_EIE) != RESET)))<br>    &#123;<br>      huart-&gt;ErrorCode |= HAL_UART_ERROR_ORE;<br>    &#125;<br><br>    <span class="hljs-comment">/* Call UART Error Call back function if need be --------------------------*/</span><br>    <span class="hljs-keyword">if</span> (huart-&gt;ErrorCode != HAL_UART_ERROR_NONE)<br>    &#123;<br>      <span class="hljs-comment">/* UART in mode Receiver -----------------------------------------------*/</span><br>      <span class="hljs-keyword">if</span> (((isrflags &amp; USART_SR_RXNE) != RESET) &amp;&amp; ((cr1its &amp; USART_CR1_RXNEIE) != RESET))<br>      &#123;<br>        UART_Receive_IT(huart);<br>      &#125;<br><br>      <span class="hljs-comment">/* If Overrun error occurs, or if any error occurs in DMA mode reception,</span><br><span class="hljs-comment">         consider error as blocking */</span><br>      dmarequest = HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br>      <span class="hljs-keyword">if</span> (((huart-&gt;ErrorCode &amp; HAL_UART_ERROR_ORE) != RESET) || dmarequest)<br>      &#123;<br>        <span class="hljs-comment">/* Blocking error : transfer is aborted</span><br><span class="hljs-comment">           Set the UART state ready to be able to start again the process,</span><br><span class="hljs-comment">           Disable Rx Interrupts, and disable Rx DMA request, if ongoing */</span><br>        UART_EndRxTransfer(huart);<br><br>        <span class="hljs-comment">/* Disable the UART DMA Rx request if enabled */</span><br>        <span class="hljs-keyword">if</span> (HAL_IS_BIT_SET(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR))<br>        &#123;<br>          CLEAR_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br><br>          <span class="hljs-comment">/* Abort the UART DMA Rx stream */</span><br>          <span class="hljs-keyword">if</span> (huart-&gt;hdmarx != <span class="hljs-literal">NULL</span>)<br>          &#123;<br>            <span class="hljs-comment">/* Set the UART DMA Abort callback :</span><br><span class="hljs-comment">               will lead to call HAL_UART_ErrorCallback() at end of DMA abort procedure */</span><br>            huart-&gt;hdmarx-&gt;XferAbortCallback = UART_DMAAbortOnError;<br>            <span class="hljs-keyword">if</span> (HAL_DMA_Abort_IT(huart-&gt;hdmarx) != HAL_OK)<br>            &#123;<br>              <span class="hljs-comment">/* Call Directly XferAbortCallback function in case of error */</span><br>              huart-&gt;hdmarx-&gt;XferAbortCallback(huart-&gt;hdmarx);<br>            &#125;<br>          &#125;<br>          <span class="hljs-keyword">else</span><br>          &#123;<br>            <span class="hljs-comment">/* Call user error callback */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>            <span class="hljs-comment">/*Call registered error callback*/</span><br>            huart-&gt;ErrorCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>            <span class="hljs-comment">/*Call legacy weak error callback*/</span><br>            HAL_UART_ErrorCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br>          &#125;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          <span class="hljs-comment">/* Call user error callback */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>          <span class="hljs-comment">/*Call registered error callback*/</span><br>          huart-&gt;ErrorCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>          <span class="hljs-comment">/*Call legacy weak error callback*/</span><br>          HAL_UART_ErrorCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-comment">/* Non Blocking error : transfer could go on.</span><br><span class="hljs-comment">           Error is notified to user through user error callback */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>        <span class="hljs-comment">/*Call registered error callback*/</span><br>        huart-&gt;ErrorCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">else</span></span><br>        <span class="hljs-comment">/*Call legacy weak error callback*/</span><br>        HAL_UART_ErrorCallback(huart);<br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br><br>        huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span>;<br>  &#125; <span class="hljs-comment">/* End if some error occurs */</span><br><br>  <span class="hljs-comment">/* UART in mode Transmitter ------------------------------------------------*/</span><br>  <span class="hljs-keyword">if</span> (((isrflags &amp; USART_SR_TXE) != RESET) &amp;&amp; ((cr1its &amp; USART_CR1_TXEIE) != RESET))<br>  &#123;<br>    UART_Transmit_IT(huart);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br><br>  <span class="hljs-comment">/* UART in mode Transmitter end --------------------------------------------*/</span><br>  <span class="hljs-keyword">if</span> (((isrflags &amp; USART_SR_TC) != RESET) &amp;&amp; ((cr1its &amp; USART_CR1_TCIE) != RESET))<br>  &#123;<br>    UART_EndTransmit_IT(huart);<br>    <span class="hljs-keyword">return</span>;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-MspDeInit-UART-HandleTypeDef-uartHandle"><a href="#HAL-UART-MspDeInit-UART-HandleTypeDef-uartHandle" class="headerlink" title="HAL_UART_MspDeInit(UART_HandleTypeDef* uartHandle)"></a>HAL_UART_MspDeInit(UART_HandleTypeDef* uartHandle)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_MspDeInit</span><span class="hljs-params">(UART_HandleTypeDef* uartHandle)</span></span><br><span class="hljs-function"></span>&#123;<br><br>  <span class="hljs-keyword">if</span>(uartHandle-&gt;Instance==USART2)<br>  &#123;<br>  <span class="hljs-comment">/* USER CODE BEGIN USART2_MspDeInit 0 */</span><br><br>  <span class="hljs-comment">/* USER CODE END USART2_MspDeInit 0 */</span><br>    <span class="hljs-comment">/* Peripheral clock disable */</span><br>    __HAL_RCC_USART2_CLK_DISABLE();<br><br>    <span class="hljs-comment">/**USART2 GPIO Configuration</span><br><span class="hljs-comment">    PA2     ------&gt; USART2_TX</span><br><span class="hljs-comment">    PA3     ------&gt; USART2_RX</span><br><span class="hljs-comment">    */</span><br>    HAL_GPIO_DeInit(GPIOA, USART_TX_Pin|USART_RX_Pin);<br><br>    <span class="hljs-comment">/* USART2 interrupt Deinit */</span><br>    HAL_NVIC_DisableIRQ(USART2_IRQn);<br>  <span class="hljs-comment">/* USER CODE BEGIN USART2_MspDeInit 1 */</span><br><br>  <span class="hljs-comment">/* USER CODE END USART2_MspDeInit 1 */</span><br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-Receive-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size-uint32-t-Timeout"><a href="#HAL-UART-Receive-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size-uint32-t-Timeout" class="headerlink" title="HAL_UART_Receive(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size, uint32_t Timeout)"></a>HAL_UART_Receive(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size, uint32_t Timeout)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Receives an amount of data in blocking mode.</span><br><span class="hljs-comment">  * @note   When UART parity is not enabled (PCE = 0), and Word Length is configured to 9 bits (M1-M0 = 01),</span><br><span class="hljs-comment">  *         the received data is handled as a set of u16. In this case, Size must indicate the number</span><br><span class="hljs-comment">  *         of u16 available through pData.</span><br><span class="hljs-comment">  * @param  huart Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *               the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @param  pData Pointer to data buffer (u8 or u16 data elements).</span><br><span class="hljs-comment">  * @param  Size  Amount of data elements (u8 or u16) to be received.</span><br><span class="hljs-comment">  * @param  Timeout Timeout duration</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Receive</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint16_t</span> *tmp;<br>  <span class="hljs-keyword">uint32_t</span> tickstart = <span class="hljs-number">0U</span>;<br><br>  <span class="hljs-comment">/* Check that a Rx process is not already ongoing */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;RxState == HAL_UART_STATE_READY)<br>  &#123;<br>    <span class="hljs-keyword">if</span> ((pData == <span class="hljs-literal">NULL</span>) || (Size == <span class="hljs-number">0U</span>))<br>    &#123;<br>      <span class="hljs-keyword">return</span>  HAL_ERROR;<br>    &#125;<br><br>    <span class="hljs-comment">/* Process Locked */</span><br>    __HAL_LOCK(huart);<br><br>    huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>    huart-&gt;RxState = HAL_UART_STATE_BUSY_RX;<br><br>    <span class="hljs-comment">/* Init tickstart for timeout managment */</span><br>    tickstart = HAL_GetTick();<br><br>    huart-&gt;RxXferSize = Size;<br>    huart-&gt;RxXferCount = Size;<br><br>    <span class="hljs-comment">/* Process Unlocked */</span><br>    __HAL_UNLOCK(huart);<br><br>    <span class="hljs-comment">/* Check the remain data to be received */</span><br>    <span class="hljs-keyword">while</span> (huart-&gt;RxXferCount &gt; <span class="hljs-number">0U</span>)<br>    &#123;<br>      huart-&gt;RxXferCount--;<br>      <span class="hljs-keyword">if</span> (huart-&gt;Init.WordLength == UART_WORDLENGTH_9B)<br>      &#123;<br>        <span class="hljs-keyword">if</span> (UART_WaitOnFlagUntilTimeout(huart, UART_FLAG_RXNE, RESET, tickstart, Timeout) != HAL_OK)<br>        &#123;<br>          <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>        &#125;<br>        tmp = (<span class="hljs-keyword">uint16_t</span> *) pData;<br>        <span class="hljs-keyword">if</span> (huart-&gt;Init.Parity == UART_PARITY_NONE)<br>        &#123;<br>          *tmp = (<span class="hljs-keyword">uint16_t</span>)(huart-&gt;Instance-&gt;DR &amp; (<span class="hljs-keyword">uint16_t</span>)<span class="hljs-number">0x01FF</span>);<br>          pData += <span class="hljs-number">2U</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          *tmp = (<span class="hljs-keyword">uint16_t</span>)(huart-&gt;Instance-&gt;DR &amp; (<span class="hljs-keyword">uint16_t</span>)<span class="hljs-number">0x00FF</span>);<br>          pData += <span class="hljs-number">1U</span>;<br>        &#125;<br><br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-keyword">if</span> (UART_WaitOnFlagUntilTimeout(huart, UART_FLAG_RXNE, RESET, tickstart, Timeout) != HAL_OK)<br>        &#123;<br>          <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (huart-&gt;Init.Parity == UART_PARITY_NONE)<br>        &#123;<br>          *pData++ = (<span class="hljs-keyword">uint8_t</span>)(huart-&gt;Instance-&gt;DR &amp; (<span class="hljs-keyword">uint8_t</span>)<span class="hljs-number">0x00FF</span>);<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          *pData++ = (<span class="hljs-keyword">uint8_t</span>)(huart-&gt;Instance-&gt;DR &amp; (<span class="hljs-keyword">uint8_t</span>)<span class="hljs-number">0x007F</span>);<br>        &#125;<br><br>      &#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* At end of Rx process, restore huart-&gt;RxState to Ready */</span><br>    huart-&gt;RxState = HAL_UART_STATE_READY;<br><br>    <span class="hljs-keyword">return</span> HAL_OK;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">return</span> HAL_BUSY;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-Receive-DMA-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size"><a href="#HAL-UART-Receive-DMA-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size" class="headerlink" title="HAL_UART_Receive_DMA(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)"></a>HAL_UART_Receive_DMA(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Receives an amount of data in DMA mode.</span><br><span class="hljs-comment">  * @note   When UART parity is not enabled (PCE = 0), and Word Length is configured to 9 bits (M1-M0 = 01),</span><br><span class="hljs-comment">  *         the received data is handled as a set of u16. In this case, Size must indicate the number</span><br><span class="hljs-comment">  *         of u16 available through pData.</span><br><span class="hljs-comment">  * @param  huart Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *               the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @param  pData Pointer to data buffer (u8 or u16 data elements).</span><br><span class="hljs-comment">  * @param  Size  Amount of data elements (u8 or u16) to be received.</span><br><span class="hljs-comment">  * @note   When the UART parity is enabled (PCE = 1) the received data contains the parity bit.</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Receive_DMA</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint32_t</span> *tmp;<br><br>  <span class="hljs-comment">/* Check that a Rx process is not already ongoing */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;RxState == HAL_UART_STATE_READY)<br>  &#123;<br>    <span class="hljs-keyword">if</span> ((pData == <span class="hljs-literal">NULL</span>) || (Size == <span class="hljs-number">0U</span>))<br>    &#123;<br>      <span class="hljs-keyword">return</span> HAL_ERROR;<br>    &#125;<br><br>    <span class="hljs-comment">/* Process Locked */</span><br>    __HAL_LOCK(huart);<br><br>    huart-&gt;pRxBuffPtr = pData;<br>    huart-&gt;RxXferSize = Size;<br><br>    huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>    huart-&gt;RxState = HAL_UART_STATE_BUSY_RX;<br><br>    <span class="hljs-comment">/* Set the UART DMA transfer complete callback */</span><br>    huart-&gt;hdmarx-&gt;XferCpltCallback = UART_DMAReceiveCplt;<br><br>    <span class="hljs-comment">/* Set the UART DMA Half transfer complete callback */</span><br>    huart-&gt;hdmarx-&gt;XferHalfCpltCallback = UART_DMARxHalfCplt;<br><br>    <span class="hljs-comment">/* Set the DMA error callback */</span><br>    huart-&gt;hdmarx-&gt;XferErrorCallback = UART_DMAError;<br><br>    <span class="hljs-comment">/* Set the DMA abort callback */</span><br>    huart-&gt;hdmarx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-comment">/* Enable the DMA stream */</span><br>    tmp = (<span class="hljs-keyword">uint32_t</span> *)&amp;pData;<br>    HAL_DMA_Start_IT(huart-&gt;hdmarx, (<span class="hljs-keyword">uint32_t</span>)&amp;huart-&gt;Instance-&gt;DR, *(<span class="hljs-keyword">uint32_t</span> *)tmp, Size);<br><br>    <span class="hljs-comment">/* Clear the Overrun flag just before enabling the DMA Rx request: can be mandatory for the second transfer */</span><br>    __HAL_UART_CLEAR_OREFLAG(huart);<br><br>    <span class="hljs-comment">/* Process Unlocked */</span><br>    __HAL_UNLOCK(huart);<br><br>    <span class="hljs-comment">/* Enable the UART Parity Error Interrupt */</span><br>    SET_BIT(huart-&gt;Instance-&gt;CR1, USART_CR1_PEIE);<br><br>    <span class="hljs-comment">/* Enable the UART Error Interrupt: (Frame error, noise error, overrun error) */</span><br>    SET_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_EIE);<br><br>    <span class="hljs-comment">/* Enable the DMA transfer for the receiver request by setting the DMAR bit</span><br><span class="hljs-comment">    in the UART CR3 register */</span><br>    SET_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAR);<br><br>    <span class="hljs-keyword">return</span> HAL_OK;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">return</span> HAL_BUSY;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-Receive-IT-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size"><a href="#HAL-UART-Receive-IT-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size" class="headerlink" title="HAL_UART_Receive_IT(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)"></a>HAL_UART_Receive_IT(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Receives an amount of data in non blocking mode.</span><br><span class="hljs-comment">  * @note   When UART parity is not enabled (PCE = 0), and Word Length is configured to 9 bits (M1-M0 = 01),</span><br><span class="hljs-comment">  *         the received data is handled as a set of u16. In this case, Size must indicate the number</span><br><span class="hljs-comment">  *         of u16 available through pData.</span><br><span class="hljs-comment">  * @param  huart Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *               the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @param  pData Pointer to data buffer (u8 or u16 data elements).</span><br><span class="hljs-comment">  * @param  Size  Amount of data elements (u8 or u16) to be received.</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Receive_IT</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Check that a Rx process is not already ongoing */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;RxState == HAL_UART_STATE_READY)<br>  &#123;<br>    <span class="hljs-keyword">if</span> ((pData == <span class="hljs-literal">NULL</span>) || (Size == <span class="hljs-number">0U</span>))<br>    &#123;<br>      <span class="hljs-keyword">return</span> HAL_ERROR;<br>    &#125;<br><br>    <span class="hljs-comment">/* Process Locked */</span><br>    __HAL_LOCK(huart);<br><br>    huart-&gt;pRxBuffPtr = pData;<br>    huart-&gt;RxXferSize = Size;<br>    huart-&gt;RxXferCount = Size;<br><br>    huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>    huart-&gt;RxState = HAL_UART_STATE_BUSY_RX;<br><br>    <span class="hljs-comment">/* Process Unlocked */</span><br>    __HAL_UNLOCK(huart);<br><br>    <span class="hljs-comment">/* Enable the UART Parity Error Interrupt */</span><br>    __HAL_UART_ENABLE_IT(huart, UART_IT_PE);<br><br>    <span class="hljs-comment">/* Enable the UART Error Interrupt: (Frame error, noise error, overrun error) */</span><br>    __HAL_UART_ENABLE_IT(huart, UART_IT_ERR);<br><br>    <span class="hljs-comment">/* Enable the UART Data Register not empty Interrupt */</span><br>    __HAL_UART_ENABLE_IT(huart, UART_IT_RXNE);<br><br>    <span class="hljs-keyword">return</span> HAL_OK;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">return</span> HAL_BUSY;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-RxCpltCallback-UART-HandleTypeDef-huart"><a href="#HAL-UART-RxCpltCallback-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)"></a>HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Rx Transfer completed callbacks.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_RxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Prevent unused argument(s) compilation warning */</span><br>  UNUSED(huart);<br>  <span class="hljs-comment">/* <span class="hljs-doctag">NOTE:</span> This function should not be modified, when the callback is needed,</span><br><span class="hljs-comment">           the HAL_UART_RxCpltCallback could be implemented in the user file</span><br><span class="hljs-comment">   */</span><br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-Transmit-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size-uint32-t-Timeout"><a href="#HAL-UART-Transmit-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size-uint32-t-Timeout" class="headerlink" title="HAL_UART_Transmit(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size, uint32_t Timeout)"></a>HAL_UART_Transmit(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size, uint32_t Timeout)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Sends an amount of data in blocking mode.</span><br><span class="hljs-comment">  * @note   When UART parity is not enabled (PCE = 0), and Word Length is configured to 9 bits (M1-M0 = 01),</span><br><span class="hljs-comment">  *         the sent data is handled as a set of u16. In this case, Size must indicate the number</span><br><span class="hljs-comment">  *         of u16 provided through pData.</span><br><span class="hljs-comment">  * @param  huart Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *               the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @param  pData Pointer to data buffer (u8 or u16 data elements).</span><br><span class="hljs-comment">  * @param  Size  Amount of data elements (u8 or u16) to be sent</span><br><span class="hljs-comment">  * @param  Timeout Timeout duration</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Transmit</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size, <span class="hljs-keyword">uint32_t</span> Timeout)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint16_t</span> *tmp;<br>  <span class="hljs-keyword">uint32_t</span> tickstart = <span class="hljs-number">0U</span>;<br><br>  <span class="hljs-comment">/* Check that a Tx process is not already ongoing */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;gState == HAL_UART_STATE_READY)<br>  &#123;<br>    <span class="hljs-keyword">if</span> ((pData == <span class="hljs-literal">NULL</span>) || (Size == <span class="hljs-number">0U</span>))<br>    &#123;<br>      <span class="hljs-keyword">return</span>  HAL_ERROR;<br>    &#125;<br><br>    <span class="hljs-comment">/* Process Locked */</span><br>    __HAL_LOCK(huart);<br><br>    huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>    huart-&gt;gState = HAL_UART_STATE_BUSY_TX;<br><br>    <span class="hljs-comment">/* Init tickstart for timeout managment */</span><br>    tickstart = HAL_GetTick();<br><br>    huart-&gt;TxXferSize = Size;<br>    huart-&gt;TxXferCount = Size;<br><br>    <span class="hljs-comment">/* Process Unlocked */</span><br>    __HAL_UNLOCK(huart);<br><br>    <span class="hljs-keyword">while</span> (huart-&gt;TxXferCount &gt; <span class="hljs-number">0U</span>)<br>    &#123;<br>      huart-&gt;TxXferCount--;<br>      <span class="hljs-keyword">if</span> (huart-&gt;Init.WordLength == UART_WORDLENGTH_9B)<br>      &#123;<br>        <span class="hljs-keyword">if</span> (UART_WaitOnFlagUntilTimeout(huart, UART_FLAG_TXE, RESET, tickstart, Timeout) != HAL_OK)<br>        &#123;<br>          <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>        &#125;<br>        tmp = (<span class="hljs-keyword">uint16_t</span> *) pData;<br>        huart-&gt;Instance-&gt;DR = (*tmp &amp; (<span class="hljs-keyword">uint16_t</span>)<span class="hljs-number">0x01FF</span>);<br>        <span class="hljs-keyword">if</span> (huart-&gt;Init.Parity == UART_PARITY_NONE)<br>        &#123;<br>          pData += <span class="hljs-number">2U</span>;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>          pData += <span class="hljs-number">1U</span>;<br>        &#125;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        <span class="hljs-keyword">if</span> (UART_WaitOnFlagUntilTimeout(huart, UART_FLAG_TXE, RESET, tickstart, Timeout) != HAL_OK)<br>        &#123;<br>          <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>        &#125;<br>        huart-&gt;Instance-&gt;DR = (*pData++ &amp; (<span class="hljs-keyword">uint8_t</span>)<span class="hljs-number">0xFF</span>);<br>      &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (UART_WaitOnFlagUntilTimeout(huart, UART_FLAG_TC, RESET, tickstart, Timeout) != HAL_OK)<br>    &#123;<br>      <span class="hljs-keyword">return</span> HAL_TIMEOUT;<br>    &#125;<br><br>    <span class="hljs-comment">/* At end of Tx process, restore huart-&gt;gState to Ready */</span><br>    huart-&gt;gState = HAL_UART_STATE_READY;<br><br>    <span class="hljs-keyword">return</span> HAL_OK;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">return</span> HAL_BUSY;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-Transmit-DMA-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size"><a href="#HAL-UART-Transmit-DMA-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size" class="headerlink" title="HAL_UART_Transmit_DMA(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)"></a>HAL_UART_Transmit_DMA(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Sends an amount of data in DMA mode.</span><br><span class="hljs-comment">  * @note   When UART parity is not enabled (PCE = 0), and Word Length is configured to 9 bits (M1-M0 = 01),</span><br><span class="hljs-comment">  *         the sent data is handled as a set of u16. In this case, Size must indicate the number</span><br><span class="hljs-comment">  *         of u16 provided through pData.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @param  pData Pointer to data buffer (u8 or u16 data elements).</span><br><span class="hljs-comment">  * @param  Size  Amount of data elements (u8 or u16) to be sent</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Transmit_DMA</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint32_t</span> *tmp;<br><br>  <span class="hljs-comment">/* Check that a Tx process is not already ongoing */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;gState == HAL_UART_STATE_READY)<br>  &#123;<br>    <span class="hljs-keyword">if</span> ((pData == <span class="hljs-literal">NULL</span>) || (Size == <span class="hljs-number">0U</span>))<br>    &#123;<br>      <span class="hljs-keyword">return</span> HAL_ERROR;<br>    &#125;<br><br>    <span class="hljs-comment">/* Process Locked */</span><br>    __HAL_LOCK(huart);<br><br>    huart-&gt;pTxBuffPtr = pData;<br>    huart-&gt;TxXferSize = Size;<br>    huart-&gt;TxXferCount = Size;<br><br>    huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>    huart-&gt;gState = HAL_UART_STATE_BUSY_TX;<br><br>    <span class="hljs-comment">/* Set the UART DMA transfer complete callback */</span><br>    huart-&gt;hdmatx-&gt;XferCpltCallback = UART_DMATransmitCplt;<br><br>    <span class="hljs-comment">/* Set the UART DMA Half transfer complete callback */</span><br>    huart-&gt;hdmatx-&gt;XferHalfCpltCallback = UART_DMATxHalfCplt;<br><br>    <span class="hljs-comment">/* Set the DMA error callback */</span><br>    huart-&gt;hdmatx-&gt;XferErrorCallback = UART_DMAError;<br><br>    <span class="hljs-comment">/* Set the DMA abort callback */</span><br>    huart-&gt;hdmatx-&gt;XferAbortCallback = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-comment">/* Enable the UART transmit DMA stream */</span><br>    tmp = (<span class="hljs-keyword">uint32_t</span> *)&amp;pData;<br>    HAL_DMA_Start_IT(huart-&gt;hdmatx, *(<span class="hljs-keyword">uint32_t</span> *)tmp, (<span class="hljs-keyword">uint32_t</span>)&amp;huart-&gt;Instance-&gt;DR, Size);<br><br>    <span class="hljs-comment">/* Clear the TC flag in the SR register by writing 0 to it */</span><br>    __HAL_UART_CLEAR_FLAG(huart, UART_FLAG_TC);<br><br>    <span class="hljs-comment">/* Process Unlocked */</span><br>    __HAL_UNLOCK(huart);<br><br>    <span class="hljs-comment">/* Enable the DMA transfer for transmit request by setting the DMAT bit</span><br><span class="hljs-comment">       in the UART CR3 register */</span><br>    SET_BIT(huart-&gt;Instance-&gt;CR3, USART_CR3_DMAT);<br><br>    <span class="hljs-keyword">return</span> HAL_OK;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">return</span> HAL_BUSY;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-Transmit-IT-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size"><a href="#HAL-UART-Transmit-IT-UART-HandleTypeDef-huart-uint8-t-pData-uint16-t-Size" class="headerlink" title="HAL_UART_Transmit_IT(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)"></a>HAL_UART_Transmit_IT(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Sends an amount of data in non blocking mode.</span><br><span class="hljs-comment">  * @note   When UART parity is not enabled (PCE = 0), and Word Length is configured to 9 bits (M1-M0 = 01),</span><br><span class="hljs-comment">  *         the sent data is handled as a set of u16. In this case, Size must indicate the number</span><br><span class="hljs-comment">  *         of u16 provided through pData.</span><br><span class="hljs-comment">  * @param  huart Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *               the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @param  pData Pointer to data buffer (u8 or u16 data elements).</span><br><span class="hljs-comment">  * @param  Size  Amount of data elements (u8 or u16) to be sent</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_UART_Transmit_IT</span><span class="hljs-params">(UART_HandleTypeDef *huart, <span class="hljs-keyword">uint8_t</span> *pData, <span class="hljs-keyword">uint16_t</span> Size)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Check that a Tx process is not already ongoing */</span><br>  <span class="hljs-keyword">if</span> (huart-&gt;gState == HAL_UART_STATE_READY)<br>  &#123;<br>    <span class="hljs-keyword">if</span> ((pData == <span class="hljs-literal">NULL</span>) || (Size == <span class="hljs-number">0U</span>))<br>    &#123;<br>      <span class="hljs-keyword">return</span> HAL_ERROR;<br>    &#125;<br><br>    <span class="hljs-comment">/* Process Locked */</span><br>    __HAL_LOCK(huart);<br><br>    huart-&gt;pTxBuffPtr = pData;<br>    huart-&gt;TxXferSize = Size;<br>    huart-&gt;TxXferCount = Size;<br><br>    huart-&gt;ErrorCode = HAL_UART_ERROR_NONE;<br>    huart-&gt;gState = HAL_UART_STATE_BUSY_TX;<br><br>    <span class="hljs-comment">/* Process Unlocked */</span><br>    __HAL_UNLOCK(huart);<br><br>    <span class="hljs-comment">/* Enable the UART Transmit data register empty Interrupt */</span><br>    __HAL_UART_ENABLE_IT(huart, UART_IT_TXE);<br><br>    <span class="hljs-keyword">return</span> HAL_OK;<br>  &#125;<br>  <span class="hljs-keyword">else</span><br>  &#123;<br>    <span class="hljs-keyword">return</span> HAL_BUSY;<br>  &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-TxCpltCallback-UART-HandleTypeDef-huart"><a href="#HAL-UART-TxCpltCallback-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_TxCpltCallback(UART_HandleTypeDef *huart)"></a>HAL_UART_TxCpltCallback(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Tx Transfer completed callbacks.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_TxCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Prevent unused argument(s) compilation warning */</span><br>  UNUSED(huart);<br>  <span class="hljs-comment">/* <span class="hljs-doctag">NOTE:</span> This function should not be modified, when the callback is needed,</span><br><span class="hljs-comment">           the HAL_UART_TxCpltCallback could be implemented in the user file</span><br><span class="hljs-comment">   */</span><br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-UART-TxHalfCpltCallback-UART-HandleTypeDef-huart"><a href="#HAL-UART-TxHalfCpltCallback-UART-HandleTypeDef-huart" class="headerlink" title="HAL_UART_TxHalfCpltCallback(UART_HandleTypeDef *huart)"></a>HAL_UART_TxHalfCpltCallback(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Tx Half Transfer completed callbacks.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval None</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">__weak <span class="hljs-keyword">void</span> <span class="hljs-title">HAL_UART_TxHalfCpltCallback</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-comment">/* Prevent unused argument(s) compilation warning */</span><br>  UNUSED(huart);<br>  <span class="hljs-comment">/* <span class="hljs-doctag">NOTE:</span> This function should not be modified, when the callback is needed,</span><br><span class="hljs-comment">           the HAL_UART_TxHalfCpltCallback could be implemented in the user file</span><br><span class="hljs-comment">   */</span><br>&#125;<br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-HalfDuplex-EnableTransmitter-UART-HandleTypeDef-huart"><a href="#HAL-HalfDuplex-EnableTransmitter-UART-HandleTypeDef-huart" class="headerlink" title="HAL_HalfDuplex_EnableTransmitter(UART_HandleTypeDef *huart)"></a>HAL_HalfDuplex_EnableTransmitter(UART_HandleTypeDef *huart)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-comment">/**</span><br><span class="hljs-comment">  * @brief  Enables the UART transmitter and disables the UART receiver.</span><br><span class="hljs-comment">  * @param  huart  Pointer to a UART_HandleTypeDef structure that contains</span><br><span class="hljs-comment">  *                the configuration information for the specified UART module.</span><br><span class="hljs-comment">  * @retval HAL status</span><br><span class="hljs-comment">  */</span><br><span class="hljs-function">HAL_StatusTypeDef <span class="hljs-title">HAL_HalfDuplex_EnableTransmitter</span><span class="hljs-params">(UART_HandleTypeDef *huart)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">uint32_t</span> tmpreg = <span class="hljs-number">0x00</span>U;<br><br>  <span class="hljs-comment">/* Process Locked */</span><br>  __HAL_LOCK(huart);<br><br>  huart-&gt;gState = HAL_UART_STATE_BUSY;<br><br>  <span class="hljs-comment">/*-------------------------- USART CR1 Configuration -----------------------*/</span><br>  tmpreg = huart-&gt;Instance-&gt;CR1;<br><br>  <span class="hljs-comment">/* Clear TE and RE bits */</span><br>  tmpreg &amp;= (<span class="hljs-keyword">uint32_t</span>)~((<span class="hljs-keyword">uint32_t</span>)(USART_CR1_TE | USART_CR1_RE));<br><br>  <span class="hljs-comment">/* Enable the USART&#x27;s transmit interface by setting the TE bit in the USART CR1 register */</span><br>  tmpreg |= (<span class="hljs-keyword">uint32_t</span>)USART_CR1_TE;<br><br>  <span class="hljs-comment">/* Write to USART CR1 */</span><br>  WRITE_REG(huart-&gt;Instance-&gt;CR1, (<span class="hljs-keyword">uint32_t</span>)tmpreg);<br><br>  huart-&gt;gState = HAL_UART_STATE_READY;<br><br>  <span class="hljs-comment">/* Process Unlocked */</span><br>  __HAL_UNLOCK(huart);<br><br>  <span class="hljs-keyword">return</span> HAL_OK;<br>&#125;<br></code></pre></div></td></tr></table></figure>
<h2 id="宏定义-Define"><a href="#宏定义-Define" class="headerlink" title="宏定义 Define"></a>宏定义 Define</h2><h3 id="串口错误代码-UART-Error-Code"><a href="#串口错误代码-UART-Error-Code" class="headerlink" title="串口错误代码 (UART Error Code)"></a>串口错误代码 (UART Error Code)</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_UART_ERROR_NONE              0x00000000U   <span class="hljs-comment">/*!&lt; No error | 没有错误           */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_UART_ERROR_PE                0x00000001U   <span class="hljs-comment">/*!&lt; Parity error | 奇偶校验错误       */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_UART_ERROR_NE                0x00000002U   <span class="hljs-comment">/*!&lt; Noise error | 噪声错误标志        */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_UART_ERROR_FE                0x00000004U   <span class="hljs-comment">/*!&lt; Frame error | 帧错误        */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_UART_ERROR_ORE               0x00000008U   <span class="hljs-comment">/*!&lt; Overrun error | 溢出错误      */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_UART_ERROR_DMA               0x00000010U   <span class="hljs-comment">/*!&lt; DMA transfer error | DMA传输错误   */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span>  HAL_UART_ERROR_INVALID_CALLBACK 0x00000020U   <span class="hljs-comment">/*!&lt; Invalid Callback error  */</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span> <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br></code></pre></div></td></tr></table></figure>
<h3 id="串口使能与禁能"><a href="#串口使能与禁能" class="headerlink" title="串口使能与禁能"></a>串口使能与禁能</h3><ol>
<li>__HAL_UART_DISABLE</li>
<li>__HAL_UART_DISABLE_IT</li>
<li>__HAL_UART_ENABLE</li>
<li>__HAL_UART_ENABLE_IT</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_DISABLE(__HANDLE__)              ((__HANDLE__)-&gt;Instance-&gt;CR1 &amp;=  ~USART_CR1_UE)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_ENABLE(__HANDLE__)               ((__HANDLE__)-&gt;Instance-&gt;CR1 |=  USART_CR1_UE)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_DISABLE_IT(__HANDLE__, __INTERRUPT__)  ((((__INTERRUPT__) &gt;&gt; 28U) == UART_CR1_REG_INDEX)? ((__HANDLE__)-&gt;Instance-&gt;CR1 &amp;= ~((__INTERRUPT__) &amp; UART_IT_MASK)): \</span><br>                                                           (((__INTERRUPT__) &gt;&gt; <span class="hljs-number">28U</span>) == UART_CR2_REG_INDEX)? ((__HANDLE__)-&gt;Instance-&gt;CR2 &amp;= ~((__INTERRUPT__) &amp; UART_IT_MASK)): \<br>                                                           ((__HANDLE__)-&gt;Instance-&gt;CR3 &amp;= ~ ((__INTERRUPT__) &amp; UART_IT_MASK)))<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_ENABLE_IT(__HANDLE__, __INTERRUPT__)   ((((__INTERRUPT__) &gt;&gt; 28U) == UART_CR1_REG_INDEX)? ((__HANDLE__)-&gt;Instance-&gt;CR1 |= ((__INTERRUPT__) &amp; UART_IT_MASK)): \</span><br>                                                           (((__INTERRUPT__) &gt;&gt; <span class="hljs-number">28U</span>) == UART_CR2_REG_INDEX)? ((__HANDLE__)-&gt;Instance-&gt;CR2 |= ((__INTERRUPT__) &amp; UART_IT_MASK)): \<br>                                                           ((__HANDLE__)-&gt;Instance-&gt;CR3 |= ((__INTERRUPT__) &amp; UART_IT_MASK)))<br></code></pre></div></td></tr></table></figure>
<h3 id="刷新串口数据寄存器"><a href="#刷新串口数据寄存器" class="headerlink" title="刷新串口数据寄存器"></a>刷新串口数据寄存器</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_FLUSH_DRREGISTER(__HANDLE__) ((__HANDLE__)-&gt;Instance-&gt;DR)</span><br></code></pre></div></td></tr></table></figure>
<h3 id="获取-串口状态标志"><a href="#获取-串口状态标志" class="headerlink" title="获取 串口状态标志"></a>获取 串口状态标志</h3><p>状态寄存器 (<code>USART_SR</code>)<br><code>SR</code>: 是英文 <code>State Register</code> 的缩写</p>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_GET_FLAG(__HANDLE__, __FLAG__) (((__HANDLE__)-&gt;Instance-&gt;SR &amp; (__FLAG__)) == (__FLAG__))</span><br><br></code></pre></div></td></tr></table></figure>
<p>__HAL_UART_GET_FLAG(<strong>HANDLE</strong>, <strong>FLAG</strong>)</p>
<p>返回值为：<code>True</code> 或 <code>False</code></p>
<h3 id="清除标志"><a href="#清除标志" class="headerlink" title="清除标志"></a>清除标志</h3><ol>
<li>__HAL_UART_CLEAR_FEFLAG</li>
<li>__HAL_UART_CLEAR_IDLEFLAG</li>
<li>__HAL_UART_CLEAR_NEFLAG</li>
<li>__HAL_UART_CLEAR_OREFLAG</li>
<li>__HAL_UART_CLEAR_PEFLAG</li>
<li>__HAL_UART_CLEAR_FLAG</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_CLEAR_FEFLAG(__HANDLE__) __HAL_UART_CLEAR_PEFLAG(__HANDLE__)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_CLEAR_IDLEFLAG(__HANDLE__) __HAL_UART_CLEAR_PEFLAG(__HANDLE__)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_CLEAR_NEFLAG(__HANDLE__) __HAL_UART_CLEAR_PEFLAG(__HANDLE__)</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_CLEAR_OREFLAG(__HANDLE__) __HAL_UART_CLEAR_PEFLAG(__HANDLE__)</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_CLEAR_PEFLAG(__HANDLE__)     \</span><br>  <span class="hljs-keyword">do</span>&#123;                                           \<br>    __IO <span class="hljs-keyword">uint32_t</span> tmpreg = <span class="hljs-number">0x00</span>U;               \<br>    tmpreg = (__HANDLE__)-&gt;Instance-&gt;SR;        \<br>    tmpreg = (__HANDLE__)-&gt;Instance-&gt;DR;        \<br>    UNUSED(tmpreg);                             \<br>  &#125; <span class="hljs-keyword">while</span>(<span class="hljs-number">0U</span>)<br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_CLEAR_FLAG(__HANDLE__, __FLAG__) ((__HANDLE__)-&gt;Instance-&gt;SR = ~(__FLAG__))</span><br></code></pre></div></td></tr></table></figure>
<h3 id="模块选择"><a href="#模块选择" class="headerlink" title="模块选择"></a>模块选择</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> HAL_UART_MODULE_ENABLED</span><br></code></pre></div></td></tr></table></figure>
<h3 id="检查指定的UART中断源是否启用。"><a href="#检查指定的UART中断源是否启用。" class="headerlink" title="检查指定的UART中断源是否启用。"></a>检查指定的UART中断源是否启用。</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> __HAL_UART_GET_IT_SOURCE(__HANDLE__, __IT__) (((((__IT__) &gt;&gt; 28U) == UART_CR1_REG_INDEX)? (__HANDLE__)-&gt;Instance-&gt;CR1:(((((uint32_t)(__IT__)) &gt;&gt; 28U) == UART_CR2_REG_INDEX)? \</span><br>                                                      (__HANDLE__)-&gt;Instance-&gt;CR2 : (__HANDLE__)-&gt;Instance-&gt;CR3)) &amp; (((<span class="hljs-keyword">uint32_t</span>)(__IT__)) &amp; UART_IT_MASK))<br></code></pre></div></td></tr></table></figure>
<p>返回值：<code>True</code> 或 <code>False</code></p>
<h2 id="枚举"><a href="#枚举" class="headerlink" title="枚举"></a>枚举</h2><h3 id="HAL-UART-StateTypeDef"><a href="#HAL-UART-StateTypeDef" class="headerlink" title="HAL_UART_StateTypeDef"></a>HAL_UART_StateTypeDef</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span></span><br><span class="hljs-class">&#123;</span><br>  HAL_UART_STATE_RESET             = <span class="hljs-number">0x00</span>U,    <span class="hljs-comment">/*!&lt; Peripheral is not yet Initialized</span><br><span class="hljs-comment">                                                   Value is allowed for gState and RxState */</span><br>  HAL_UART_STATE_READY             = <span class="hljs-number">0x20</span>U,    <span class="hljs-comment">/*!&lt; Peripheral Initialized and ready for use</span><br><span class="hljs-comment">                                                   Value is allowed for gState and RxState */</span><br>  HAL_UART_STATE_BUSY              = <span class="hljs-number">0x24</span>U,    <span class="hljs-comment">/*!&lt; an internal process is ongoing</span><br><span class="hljs-comment">                                                   Value is allowed for gState only */</span><br>  HAL_UART_STATE_BUSY_TX           = <span class="hljs-number">0x21</span>U,    <span class="hljs-comment">/*!&lt; Data Transmission process is ongoing</span><br><span class="hljs-comment">                                                   Value is allowed for gState only */</span><br>  HAL_UART_STATE_BUSY_RX           = <span class="hljs-number">0x22</span>U,    <span class="hljs-comment">/*!&lt; Data Reception process is ongoing</span><br><span class="hljs-comment">                                                   Value is allowed for RxState only */</span><br>  HAL_UART_STATE_BUSY_TX_RX        = <span class="hljs-number">0x23</span>U,    <span class="hljs-comment">/*!&lt; Data Transmission and Reception process is ongoing</span><br><span class="hljs-comment">                                                   Not to be used for neither gState nor RxState.</span><br><span class="hljs-comment">                                                   Value is result of combination (Or) between gState and RxState values */</span><br>  HAL_UART_STATE_TIMEOUT           = <span class="hljs-number">0xA0</span>U,    <span class="hljs-comment">/*!&lt; Timeout state</span><br><span class="hljs-comment">                                                   Value is allowed for gState only */</span><br>  HAL_UART_STATE_ERROR             = <span class="hljs-number">0xE0</span>U     <span class="hljs-comment">/*!&lt; Error</span><br><span class="hljs-comment">                                                   Value is allowed for gState only */</span><br>&#125; HAL_UART_StateTypeDef;<br><br></code></pre></div></td></tr></table></figure>
<h3 id="HAL-LockTypeDef"><a href="#HAL-LockTypeDef" class="headerlink" title="HAL_LockTypeDef"></a>HAL_LockTypeDef</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">enum</span> </span><br><span class="hljs-class">&#123;</span><br>  HAL_UNLOCKED = <span class="hljs-number">0x00</span>U,<br>  HAL_LOCKED   = <span class="hljs-number">0x01</span>U  <br>&#125; HAL_LockTypeDef;<br></code></pre></div></td></tr></table></figure>
<h2 id="结构体"><a href="#结构体" class="headerlink" title="结构体"></a>结构体</h2><h3 id="UART-HandleTypeDef"><a href="#UART-HandleTypeDef" class="headerlink" title="UART_HandleTypeDef"></a>UART_HandleTypeDef</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> __<span class="hljs-title">UART_HandleTypeDef</span></span><br><span class="hljs-class">&#123;</span><br>  USART_TypeDef                 *Instance;        <span class="hljs-comment">/*!&lt; UART registers base address        */</span><br><br>  UART_InitTypeDef              Init;             <span class="hljs-comment">/*!&lt; UART communication parameters      */</span><br><br>  <span class="hljs-keyword">uint8_t</span>                       *pTxBuffPtr;      <span class="hljs-comment">/*!&lt; Pointer to UART Tx transfer Buffer */</span><br><br>  <span class="hljs-keyword">uint16_t</span>                      TxXferSize;       <span class="hljs-comment">/*!&lt; UART Tx Transfer size              */</span><br><br>  __IO <span class="hljs-keyword">uint16_t</span>                 TxXferCount;      <span class="hljs-comment">/*!&lt; UART Tx Transfer Counter           */</span><br><br>  <span class="hljs-keyword">uint8_t</span>                       *pRxBuffPtr;      <span class="hljs-comment">/*!&lt; Pointer to UART Rx transfer Buffer */</span><br><br>  <span class="hljs-keyword">uint16_t</span>                      RxXferSize;       <span class="hljs-comment">/*!&lt; UART Rx Transfer size              */</span><br><br>  __IO <span class="hljs-keyword">uint16_t</span>                 RxXferCount;      <span class="hljs-comment">/*!&lt; UART Rx Transfer Counter           */</span><br><br>  DMA_HandleTypeDef             *hdmatx;          <span class="hljs-comment">/*!&lt; UART Tx DMA Handle parameters      */</span><br><br>  DMA_HandleTypeDef             *hdmarx;          <span class="hljs-comment">/*!&lt; UART Rx DMA Handle parameters      */</span><br><br>  HAL_LockTypeDef               Lock;             <span class="hljs-comment">/*!&lt; Locking object                     */</span><br><br>  __IO HAL_UART_StateTypeDef    gState;           <span class="hljs-comment">/*!&lt; UART state information related to global Handle management</span><br><span class="hljs-comment">                                                       and also related to Tx operations.</span><br><span class="hljs-comment">                                                       This parameter can be a value of @ref HAL_UART_StateTypeDef */</span><br><br>  __IO HAL_UART_StateTypeDef    RxState;          <span class="hljs-comment">/*!&lt; UART state information related to Rx operations.</span><br><span class="hljs-comment">                                                       This parameter can be a value of @ref HAL_UART_StateTypeDef */</span><br><br>  __IO <span class="hljs-keyword">uint32_t</span>                 ErrorCode;        <span class="hljs-comment">/*!&lt; UART Error code                    */</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">if</span> (USE_HAL_UART_REGISTER_CALLBACKS == 1)</span><br>  <span class="hljs-keyword">void</span> (* TxHalfCpltCallback)(struct __UART_HandleTypeDef *huart);        <span class="hljs-comment">/*!&lt; UART Tx Half Complete Callback        */</span><br>  <span class="hljs-keyword">void</span> (* TxCpltCallback)(struct __UART_HandleTypeDef *huart);            <span class="hljs-comment">/*!&lt; UART Tx Complete Callback             */</span><br>  <span class="hljs-keyword">void</span> (* RxHalfCpltCallback)(struct __UART_HandleTypeDef *huart);        <span class="hljs-comment">/*!&lt; UART Rx Half Complete Callback        */</span><br>  <span class="hljs-keyword">void</span> (* RxCpltCallback)(struct __UART_HandleTypeDef *huart);            <span class="hljs-comment">/*!&lt; UART Rx Complete Callback             */</span><br>  <span class="hljs-keyword">void</span> (* ErrorCallback)(struct __UART_HandleTypeDef *huart);             <span class="hljs-comment">/*!&lt; UART Error Callback                   */</span><br>  <span class="hljs-keyword">void</span> (* AbortCpltCallback)(struct __UART_HandleTypeDef *huart);         <span class="hljs-comment">/*!&lt; UART Abort Complete Callback          */</span><br>  <span class="hljs-keyword">void</span> (* AbortTransmitCpltCallback)(struct __UART_HandleTypeDef *huart); <span class="hljs-comment">/*!&lt; UART Abort Transmit Complete Callback */</span><br>  <span class="hljs-keyword">void</span> (* AbortReceiveCpltCallback)(struct __UART_HandleTypeDef *huart);  <span class="hljs-comment">/*!&lt; UART Abort Receive Complete Callback  */</span><br>  <span class="hljs-keyword">void</span> (* WakeupCallback)(struct __UART_HandleTypeDef *huart);            <span class="hljs-comment">/*!&lt; UART Wakeup Callback                  */</span><br><br>  <span class="hljs-keyword">void</span> (* MspInitCallback)(struct __UART_HandleTypeDef *huart);           <span class="hljs-comment">/*!&lt; UART Msp Init callback                */</span><br>  <span class="hljs-keyword">void</span> (* MspDeInitCallback)(struct __UART_HandleTypeDef *huart);         <span class="hljs-comment">/*!&lt; UART Msp DeInit callback              */</span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">endif</span>  <span class="hljs-comment">/* USE_HAL_UART_REGISTER_CALLBACKS */</span></span><br><br>&#125; UART_HandleTypeDef;<br></code></pre></div></td></tr></table></figure>
<h3 id="USART-TypeDef"><a href="#USART-TypeDef" class="headerlink" title="USART_TypeDef"></a>USART_TypeDef</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>  __IO <span class="hljs-keyword">uint32_t</span> SR;         <span class="hljs-comment">/*!&lt; USART Status register,                   Address offset: 0x00 */</span><br>  __IO <span class="hljs-keyword">uint32_t</span> DR;         <span class="hljs-comment">/*!&lt; USART Data register,                     Address offset: 0x04 */</span><br>  __IO <span class="hljs-keyword">uint32_t</span> BRR;        <span class="hljs-comment">/*!&lt; USART Baud rate register,                Address offset: 0x08 */</span><br>  __IO <span class="hljs-keyword">uint32_t</span> CR1;        <span class="hljs-comment">/*!&lt; USART Control register 1,                Address offset: 0x0C */</span><br>  __IO <span class="hljs-keyword">uint32_t</span> CR2;        <span class="hljs-comment">/*!&lt; USART Control register 2,                Address offset: 0x10 */</span><br>  __IO <span class="hljs-keyword">uint32_t</span> CR3;        <span class="hljs-comment">/*!&lt; USART Control register 3,                Address offset: 0x14 */</span><br>  __IO <span class="hljs-keyword">uint32_t</span> GTPR;       <span class="hljs-comment">/*!&lt; USART Guard time and prescaler register, Address offset: 0x18 */</span><br>&#125; USART_TypeDef;<br></code></pre></div></td></tr></table></figure>
<h3 id="UART-InitTypeDef"><a href="#UART-InitTypeDef" class="headerlink" title="UART_InitTypeDef"></a>UART_InitTypeDef</h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span></span><br><span class="hljs-class">&#123;</span><br>  <span class="hljs-keyword">uint32_t</span> BaudRate;                  <span class="hljs-comment">/*!&lt; This member configures the UART communication baud rate.</span><br><span class="hljs-comment">                                           The baud rate is computed using the following formula:</span><br><span class="hljs-comment">                                           - IntegerDivider = ((PCLKx) / (8 * (OVR8+1) * (huart-&gt;Init.BaudRate)))</span><br><span class="hljs-comment">                                           - FractionalDivider = ((IntegerDivider - ((uint32_t) IntegerDivider)) * 8 * (OVR8+1)) + 0.5</span><br><span class="hljs-comment">                                           Where OVR8 is the &quot;oversampling by 8 mode&quot; configuration bit in the CR1 register. */</span><br><br>  <span class="hljs-keyword">uint32_t</span> WordLength;                <span class="hljs-comment">/*!&lt; Specifies the number of data bits transmitted or received in a frame.</span><br><span class="hljs-comment">                                           This parameter can be a value of @ref UART_Word_Length */</span><br><br>  <span class="hljs-keyword">uint32_t</span> StopBits;                  <span class="hljs-comment">/*!&lt; Specifies the number of stop bits transmitted.</span><br><span class="hljs-comment">                                           This parameter can be a value of @ref UART_Stop_Bits */</span><br><br>  <span class="hljs-keyword">uint32_t</span> Parity;                    <span class="hljs-comment">/*!&lt; Specifies the parity mode.</span><br><span class="hljs-comment">                                           This parameter can be a value of @ref UART_Parity</span><br><span class="hljs-comment">                                           @note When parity is enabled, the computed parity is inserted</span><br><span class="hljs-comment">                                                 at the MSB position of the transmitted data (9th bit when</span><br><span class="hljs-comment">                                                 the word length is set to 9 data bits; 8th bit when the</span><br><span class="hljs-comment">                                                 word length is set to 8 data bits). */</span><br><br>  <span class="hljs-keyword">uint32_t</span> Mode;                      <span class="hljs-comment">/*!&lt; Specifies whether the Receive or Transmit mode is enabled or disabled.</span><br><span class="hljs-comment">                                           This parameter can be a value of @ref UART_Mode */</span><br><br>  <span class="hljs-keyword">uint32_t</span> HwFlowCtl;                 <span class="hljs-comment">/*!&lt; Specifies whether the hardware flow control mode is enabled or disabled.</span><br><span class="hljs-comment">                                           This parameter can be a value of @ref UART_Hardware_Flow_Control */</span><br><br>  <span class="hljs-keyword">uint32_t</span> OverSampling;              <span class="hljs-comment">/*!&lt; Specifies whether the Over sampling 8 is enabled or disabled, to achieve higher speed (up to fPCLK/8).</span><br><span class="hljs-comment">                                           This parameter can be a value of @ref UART_Over_Sampling */</span><br>&#125; UART_InitTypeDef;<br></code></pre></div></td></tr></table></figure>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><figure class="highlight c"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs c"><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> __<span class="hljs-title">DMA_HandleTypeDef</span></span><br><span class="hljs-class">&#123;</span><br>  DMA_Stream_TypeDef         *Instance;                                                        <span class="hljs-comment">/*!&lt; Register base address                  */</span><br><br>  DMA_InitTypeDef            Init;                                                             <span class="hljs-comment">/*!&lt; DMA communication parameters           */</span> <br><br>  HAL_LockTypeDef            Lock;                                                             <span class="hljs-comment">/*!&lt; DMA locking object                     */</span>  <br><br>  __IO HAL_DMA_StateTypeDef  State;                                                            <span class="hljs-comment">/*!&lt; DMA transfer state                     */</span><br><br>  <span class="hljs-keyword">void</span>                       *Parent;                                                          <span class="hljs-comment">/*!&lt; Parent object state                    */</span> <br><br>  <span class="hljs-keyword">void</span>                       (* XferCpltCallback)( struct __DMA_HandleTypeDef * hdma);         <span class="hljs-comment">/*!&lt; DMA transfer complete callback         */</span><br><br>  <span class="hljs-keyword">void</span>                       (* XferHalfCpltCallback)( struct __DMA_HandleTypeDef * hdma);     <span class="hljs-comment">/*!&lt; DMA Half transfer complete callback    */</span><br><br>  <span class="hljs-keyword">void</span>                       (* XferM1CpltCallback)( struct __DMA_HandleTypeDef * hdma);       <span class="hljs-comment">/*!&lt; DMA transfer complete Memory1 callback */</span><br>  <br>  <span class="hljs-keyword">void</span>                       (* XferM1HalfCpltCallback)( struct __DMA_HandleTypeDef * hdma);   <span class="hljs-comment">/*!&lt; DMA transfer Half complete Memory1 callback */</span><br>  <br>  <span class="hljs-keyword">void</span>                       (* XferErrorCallback)( struct __DMA_HandleTypeDef * hdma);        <span class="hljs-comment">/*!&lt; DMA transfer error callback            */</span><br>  <br>  <span class="hljs-keyword">void</span>                       (* XferAbortCallback)( struct __DMA_HandleTypeDef * hdma);        <span class="hljs-comment">/*!&lt; DMA transfer Abort callback            */</span>  <br><br>  __IO <span class="hljs-keyword">uint32_t</span>              ErrorCode;                                                        <span class="hljs-comment">/*!&lt; DMA Error code                          */</span><br>  <br>  <span class="hljs-keyword">uint32_t</span>                   StreamBaseAddress;                                                <span class="hljs-comment">/*!&lt; DMA Stream Base Address                */</span><br><br>  <span class="hljs-keyword">uint32_t</span>                   StreamIndex;                                                      <span class="hljs-comment">/*!&lt; DMA Stream Index                       */</span><br> <br>&#125;DMA_HandleTypeDef;<br></code></pre></div></td></tr></table></figure>
            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/">电子技术</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/STM32/">STM32</a>
                    
                      <a class="hover-with-bg" href="/tags/USART/">USART</a>
                    
                      <a class="hover-with-bg" href="/tags/%E4%B8%B2%E5%8F%A3/">串口</a>
                    
                      <a class="hover-with-bg" href="/tags/%E5%87%BD%E6%95%B0/">函数</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/01/04/stm32-freertos-key-led/">
                        <span class="hidden-mobile">FreeRTOS STM32 实现LED闪烁，KEY任务挂起与恢复任务</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
              <!-- Comments -->
              <article class="comments" id="comments">
                
                
  <div class="disqus" style="width:100%">
    <div id="disqus_thread"></div>
    <script>
      Fluid.utils.waitElementVisible('disqus_thread', function() {
        Fluid.utils.createCssLink('https://cdn.jsdelivr.net/npm/disqusjs@1.0/dist/disqusjs.css');
        Fluid.utils.createScript('https://cdn.jsdelivr.net/npm/disqusjs@1.0/dist/disqus.js', function () {
          new DisqusJS({
            shortname: 'demo',
            apikey: 'AAy1C4DFz9M53p1E8j2sRcbWu6UnisFOEYLamItnJM9vMSdNpYmogcVzpVgdYy8e'
          });
        });
      });
    </script>
    <noscript>Please enable JavaScript to view the
      <a target="_blank" href="https://disqus.com/?ref_noscript" rel="nofollow noopener noopener">comments powered by Disqus.</a>
    </noscript>
  </div>


              </article>
            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     © 2020-2020 峰影(zsf90). All rights reserved.<br> <a href="/atom.xml"><span>atom.xml</span></a> |  构建 <a href="https://hexo.io" target="_blank" rel="nofollow noopener" title="Hexo"><span>Hexo</span></a> |  主题  <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener" title="Fluid 主题"><span>Fluid</span></a> |  <a href="https://www.github.com/fy2008" target="_blank" title="我的Github"><span>Github</span></a> |  <a href="/sitemap.xml">sitemap</a> |  <a href="/baidusitemap.xml">百度网站地图</a> 
  </div>
  
  <div class="statistics">
    
    

    
      
        <!-- LeanCloud 统计PV -->
        <span id="leancloud-site-pv-container" style="display: none">
            总访问量 
            <span id="leancloud-site-pv"></span>
             次
          </span>
      
      
        <!-- LeanCloud 统计UV -->
        <span id="leancloud-site-uv-container" style="display: none">
            总访客数 
            <span id="leancloud-site-uv"></span>
             人
          </span>
      

    
  </div>


  

  
</footer>

<!-- SCRIPTS -->

  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  



  <script  src="https://cdn.jsdelivr.net/npm/tocbot@4.12.0/dist/tocbot.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4.3.0/anchor.min.js" ></script>



  <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2.0.6/dist/clipboard.min.js" ></script>




  <script defer src="/js/leancloud.js" ></script>



  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2.0.11/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
      typing(title)
      
    })(window, document);
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    (function () {
      var path = "/local-search.xml";
      var inputArea = document.querySelector("#local-search-input");
      inputArea.onclick = function () {
        searchFunc(path, 'local-search-input', 'local-search-result');
        this.onclick = null
      }
    })()
  </script>












  

  

  

  

  

  





<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>



</body>
</html>
